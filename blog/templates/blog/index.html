{% extends 'base.html' %}
{% load static %}

{% block conteudo %}
<style>
    .tabela-produtos {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 10px;
    }

    .tabela-produtos th, .tabela-produtos td {
        padding: 14px 16px;
        text-align: left;
        background-color: #fff;
        border-bottom: 1px solid #e0e0e0;
        vertical-align: middle;
    }

    .tabela-produtos th {
        background-color: #f8f9fa;
        font-weight: bold;
    }

    .tabela-produtos tr:hover td {
        background-color: #f1f1f1;
    }

    .tabela-produtos img {
        width: 60px;
        height: 60px;
        border-radius: 8px;
        object-fit: cover;
    }

    .btn-acoes a {
        margin: 2px;
        font-size: 12px;
        white-space: nowrap;
    }

    #pesquisar input[type="search"] {
        width: 200px;
    }

    @media screen and (max-width: 768px) {
        .btn-acoes a {
            display: block;
            margin: 4px 0;
        }
        #pesquisar {
            flex-direction: column;
        }
    }
</style>

<hr>
<div style="width: 80%; margin: 0 auto;">
    <header class="navbar navbar-light bg-light d-flex justify-content-between align-items-center rounded p-3 shadow-sm" id="nav_index">
        <form class="form-inline" id="pesquisar">
            <input class="form-control mr-2" type="search" name="pesq" placeholder="Pesquisar produto..." aria-label="Pesquisar">
            <button class="btn btn-outline-primary" type="submit">Pesquisar</button>
        </form>
        <a class="btn btn-success" id="btn_cadastra" href="{% url 'add_produtos' %}">Cadastrar Produto</a>
    </header>
</div>

<hr>

{% if messages %}
<div class="container mt-3">
    {% for msg in messages %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    {% endfor %}
</div>

<script>
    setTimeout(function() {
        $('.alert').alert('close');
    }, 4000);
</script>
{% endif %}

<div class="container mt-4">
    <div class="table-responsive">
        <table class="table tabela-produtos shadow-sm rounded">
            <thead class="thead-light">
                <tr>
                    <th>Foto</th>
                    <th>Nome</th>
                    <th>Preço de Venda</th>
                    <th>Preço de Custo</th>
                    <th>Estoque</th>
                    <th>Data Cad.</th>
                    <th class="text-center">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for post in produtos %}
                <tr>
                    <td>
                        {% if post.imagem %}
                            <img src="{{ post.imagem.url }}" alt="{{ post.nome }}">
                        {% else %}
                            <img src="{% static 'img/sem_imagem.jpg' %}" alt="Imagem não disponível">
                        {% endif %}
                    </td>
                    <td>{{ post.nome }}</td>
                    <td>R$ {{ post.preco|floatformat:2 }}</td>
                    <td>R$ {{ post.preco_comprado|floatformat:2 }}</td>
                    <td>{{ post.estoque }}</td>
                    <td>{{ post.data|date:"d/m/Y H:i" }}</td>
                    <td class="text-center">
                        <div class="btn-acoes d-flex flex-wrap justify-content-center">
                            <a href="{% url 'colocar_em_oferta' post.id %}" style="width: 110px;" class="btn {% if post.em_oferta %}btn-success{% else %}btn-warning{% endif %}">
                                {% if post.em_oferta %}Remover Oferta{% else %}Colocar em Oferta{% endif %}
                            </a>
                            <a href="{% url 'edit_produtos' post.id %}" class="btn btn-secondary">Editar</a>
                            <a href="{% url 'del_produto' post.id %}" class="btn btn-danger">Excluir</a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center text-muted">Nenhum produto encontrado.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock conteudo %}
